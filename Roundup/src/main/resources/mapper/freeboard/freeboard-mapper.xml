<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="freeboard">

<select id="selectfreeBoardList" resultType="freeboard">
	select * from free_board order by free_board_no desc
</select>

<select id="selectfreeBoardListCount" resultType="_int">
	select count(*) from free_board
</select>

<select id="selectfreeBoardOne" resultType="freeboard">
	select * from free_board where free_board_no=#{no}
</select>

<select id="selectfreeBoardFileList" resultType="freeboardFile">
	select * from free_board_file where free_board_no=#{no}
</select>

<select id="selectfreeBoardCommentList" resultType="freeboardComment">
	 select *
	 from tbl_comment
	 where free_board_no=#{no}
	 start with comment_level =1
	 connect by prior comment_no = parent_comment
	 order siblings by comment_enrolldate
</select>

<select id="totalCommentCount" resultType="_int">
	select count(*) from tbl_comment where free_board_no=#{no}
</select>

<insert id="insertComment">

	<choose>
		<when test="#{parent_comment eq 0}">
		insert into tbl_comment(comment_no,member_id,free_board_no,parent_comment,comment_content,comment_enrolldate,comment_level)
		values(6,#{member_id},#{free_board_no},null,#{comment_content},sysdate,#{comment_level})	
		</when>
		<otherwise>
		insert into tbl_comment(comment_no,member_id,free_board_no,parent_comment,comment_content,comment_enrolldate,comment_level)
		values(6,#{member_id},#{free_board_no},#{parent_comment},#{comment_content},sysdate,#{comment_level})
		</otherwise>
	</choose>
	<selectKey 
		keyProperty="comment_no,member_id,free_board_no,parent_comment,comment_content,comment_level,comment_enrolldate"
		order="AFTER" resultType="freeboardComment">
		select comment_no,member_id,free_board_no,parent_comment,comment_content,comment_level,comment_enrolldate
		from tbl_comment
		where comment_no=6
	</selectKey>
</insert>


</mapper>
